var dbPromise=idb.open("lukask-store",1,function(e){e.objectStoreNames.contains("publication")||e.createObjectStore("publication",{keyPath:"id"}),e.objectStoreNames.contains("qtype")||e.createObjectStore("qtype",{keyPath:"id"}),e.objectStoreNames.contains("comment")||e.createObjectStore("comment",{keyPath:"id"}),e.objectStoreNames.contains("reply")||e.createObjectStore("reply",{keyPath:"id"}),e.objectStoreNames.contains("ownuser")||e.createObjectStore("ownuser",{keyPath:"id"}),e.objectStoreNames.contains("province")||e.createObjectStore("province",{keyPath:"id"}),e.objectStoreNames.contains("canton")||e.createObjectStore("canton",{keyPath:"id"}),e.objectStoreNames.contains("parroquia")||e.createObjectStore("parroquia",{keyPath:"id"}),e.objectStoreNames.contains("sync-pub")||e.createObjectStore("sync-pub",{keyPath:"id"}),e.objectStoreNames.contains("sync-comment")||e.createObjectStore("sync-comment",{keyPath:"id"}),e.objectStoreNames.contains("sync-relevance")||e.createObjectStore("sync-relevance",{keyPath:"id"}),e.objectStoreNames.contains("sync-user-profile")||e.createObjectStore("sync-user-profile",{keyPath:"id"})});function writeData(a,n){return dbPromise.then(function(e){var t=e.transaction(a,"readwrite");return t.objectStore(a).put(n),t.complete})}function readAllData(t){return dbPromise.then(function(e){return e.transaction(t,"readonly").objectStore(t).getAll()})}function clearAllData(a){return dbPromise.then(function(e){var t=e.transaction(a,"readwrite");return t.objectStore(a).clear(),t.complete})}function deleteItemData(a,n){return dbPromise.then(function(e){var t=e.transaction(a,"readwrite");return t.objectStore(a).delete(n),t.complete}).then(function(){console.log("[UTILITY-DB]: ITEM DELETED")})}function urlBase64ToUint8Array(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),a=window.atob(t),n=new Uint8Array(a.length),r=0;r<a.length;r++)n[r]=a.charCodeAt(r);return n}function dataURItoBlob(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),r=new Uint8Array(n),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return new Blob([n],{type:a})}function verifyStoredDataArray(n,r){readAllData(n).then(function(e){for(var t=0;t<r.length;t++){switch(n){case"publication":r[t].id=r[t].id_publication;break;case"qtype":r[t].id=r[t].id_type_publication;break;case"province":r[t].id=r[t].id_province;break;case"canton":r[t].id=r[t].id_canton;break;case"parroquia":r[t].id=r[t].id_parish}for(var a=0;a<e.length;a++)e[a].id==r[t].id&&(deleteItemData(n,e[a].id),e.splice(a,1),a=e.length);writeData(n,r[t])}})}function verifyStoredData(a,n,r){readAllData(a).then(function(e){switch(a){case"publication":n.id=n.id_publication;break;case"qtype":n.id=n.id_type_publication}for(var t=0;t<e.length;t++)e[t].id==n.id&&(deleteItemData(a,e[t].id),e.splice(t,1),t=e.length);0==r&&writeData(a,n)})}function upgradeTableFieldDataArray(l,s){readAllData(l).then(function(e){for(var t=0;t<s.length;t++){for(var a=null,n=0;n<e.length;n++){var r=0;switch(l){case"comment":if(e[n].id==s[t].publication){for(var i=0;i<e[n].comments.length;i++)e[n].comments[i].id_action==s[t].id_action&&(e[n].comments[i]=s[t],i=e[n].comments.length,r=1);if(0==r){var o=e[n].comments.length;e[n].comments[o]=s[t],r=1}}break;case"reply":if(e[n].id==s[t].action_parent){for(var c=0;c<e[n].replies.length;c++)e[n].replies[c].id_action==s[t].id_action&&(e[n].replies[c]=s[t],c=e[n].replies.length,r=1);if(0==r){o=e[n].replies.length;e[n].replies[o]=s[t],r=1}}}1==r&&(a=e[n],n=e.length)}if(null==a){switch(l){case"comment":a={id:s[t].publication,comments:[s[t]]};break;case"reply":a={id:s[t].action_parent,replies:[s[t]]}}e[e.length]=a}else deleteItemData(l,a.id);writeData(l,a)}})}function upgradeTableFieldData(c,l){readAllData(c).then(function(e){for(var t=null,a=0;a<e.length;a++){var n=0;switch(c){case"comment":if(e[a].id==l.publication){for(var r=0;r<e[a].comments.length;r++)e[a].comments[r].id_action==l.id_action&&(e[a].comments[r]=l,r=e[a].comments.length,n=1);if(0==n){var i=e[a].comments.length;e[a].comments[i]=l,n=1}}break;case"reply":if(e[a].id==l.action_parent){for(var o=0;o<e[a].replies.length;o++)e[a].replies[o].id_action==l.id_action&&(e[a].replies[o]=l,o=e[a].replies.length,n=1);if(0==n){i=e[a].replies.length;e[a].replies[i]=l,n=1}}}1==n&&(t=e[a],a=e.length)}if(null==t){switch(c){case"comment":t={id:l.publication,comments:[l]};break;case"reply":t={id:l.action_parent,replies:[l]}}e[e.length]=t}else deleteItemData(c,t.id);writeData(c,t)})}function clearAllDataByParentId(a,n){return readAllData(a).then(function(e){for(var t=0;t<e.length;t++)if(e[t].id==n)return deleteItemData(a,n)})}